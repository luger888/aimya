<?php $availableLesson = $this->availableLesson; ?>
<div class="tabsHolder clearfix">
    <?php echo $this->partial('partials/lesson.phtml')?>
    <div class="mainContainer clearfix">
        <?php $users = $this->userList; ?>

            <table class="table">
                <thead>
                <tr>
                    <td> First Name</td>
                    <td> Last Name</td>
                    <!--<td> User Name</td>
                    <td> Time Zone</td>
                    <td> Block / Delete</td>-->
                </tr>
                </thead>
                <?php foreach($users as $user): ?>
                <?php if($user['id'] != Zend_Auth::getInstance()->getIdentity()->id):?>
                    <tr>
                        <td><b><?php echo $user['username']?></b></td>
                        <td>
                            <form method="POST" id='start_session_<?php echo $user['id'];?>' action="<?php echo $this->baseUrl() . '/lesson/setup/'?>">
                                <input name="student_id" type="hidden" value="<?php echo $user['id'];?>">
                                <?php if(Zend_Auth::getInstance()->getIdentity()->role > 1 && !$availableLesson):?>
                                    <a href="#" id="<?php echo $user['id'];?>" onclick="jQuery('#start_session_<?php echo $user['id'];?>').submit()">Start Session</a>
                                <?php else:?>
                                    <?php echo "You can't start new lesson because you have active lesson. Go to \"On yhe Air Tab\" to end old lesson"?>
                                <?php endif;?>
                            </form>
                        </td>
                    </tr>
                    <?php endif?>
                <?php endforeach; ?>
            </table>

    </div>
    <!--<div id="tabs-2">
        <div id="flash_element">
            <?php /*$this->flashObj;*/?>
            onclick="startSession(this.id); return false;"
        </div>
    </div>-->
    <?php if(Zend_Auth::getInstance()->getIdentity()->role == 2):?>
    <script type="text/javascript">

        function startSession(id){
            var form = $('#start_session');
            var serializedData = form.serialize();
            $('#tabs').tabs('select', 1);
            $.ajax({
                'url': $('#start_session').attr('action'),
                'data': ({student_id : id}),
                //'data': serializedData,
                'dataType': 'json',
                'type': 'get',
                success: function(data) {
                    $('#flash_element').append(data.flashObj);
                }
            });
        }
    </script>
    <?php elseif(Zend_Auth::getInstance()->getIdentity()->role == 1):?>
    <script type="text/javascript">
        function doAjax() {
            $.ajax({
                'url': '<?php echo $this->baseUrl() . "/lesson/join/";?>',
                'data': ({student_id : 3}),
                //'data': serializedData,
                'dataType': 'json',
                'type': 'get',
                success: function(data) {
                    if(data.result == true){
                        $('#flash_element').append(data.flashObj);
                        return false;
                    } else {
                        setTimeout(doAjax,3000);
                    }
                }
            });
        }
        doAjax();
    </script>
    <?php endif; ?>
</div>